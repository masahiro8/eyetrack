{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?13a8","webpack:///./src/components/video/Video.vue?f6a5","webpack:///./src/util/getUrlParam.js","webpack:///./src/config.js","webpack:///./src/util/adjustVideoSize.js","webpack:///src/components/video/Video.vue","webpack:///./src/components/video/Video.vue?6cbe","webpack:///./src/components/video/Video.vue","webpack:///./src/components/video/Overlay.vue?1584","webpack:///./src/util/imageUtil.js","webpack:///./src/util/canvasUtil.js","webpack:///./src/constants/face.js","webpack:///./src/components/effects/EffectFlags.js","webpack:///./src/components/effects/Effects.js","webpack:///./src/util/face.js","webpack:///src/components/video/Overlay.vue","webpack:///./src/components/video/Overlay.vue?e304","webpack:///./src/components/video/Overlay.vue","webpack:///./src/components/shoot/Shoot.vue?a008","webpack:///src/components/shoot/Shoot.vue","webpack:///./src/components/shoot/Shoot.vue?b467","webpack:///./src/components/shoot/Shoot.vue","webpack:///./src/components/video/Eyes.vue?2c96","webpack:///./src/util/houghTransform.js","webpack:///./src/util/drawLense.js","webpack:///src/components/video/Eyes.vue","webpack:///./src/components/video/Eyes.vue?e8b1","webpack:///./src/components/video/Eyes.vue","webpack:///./src/util/wait.js","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue","webpack:///./src/main.js","webpack:///./src/App.vue?c650","webpack:///./src/components/video/Eyes.vue?d993","webpack:///./src/components/shoot/Shoot.vue?a4e2","webpack:///./src/components/video/Overlay.vue?0daf","webpack:///./src/components/video/Video.vue?660c"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","on","readyVideo","ref","src","rect","getPoints","points","shoot","_e","staticRenderFns","staticClass","domProps","getUrlParam","arg","params","location","search","substring","split","kv","param","isPreview","_","WINDOW_WIDTH","innerWidth","WINDOW_HEIGHT","innerHeight","FACEAPI_OPTION","devicePixelRatio","inputSize","scoreThreshold","adjustVideoSize","video","video_size","w","videoWidth","h","videoHeight","video_window_rate","size","left","top","styles","width","height","video_rect","x","y","rate","style","console","log","methods","initCamera","Promise","audio","facingMode","media","component","canvas_rect","class","showDetection","_v","toggle","getColorAverage","index","setPixelColor","rgba","g","b","a","Color2Value","ctx","THRESHOLD","getImageData","dst","createImageData","parseInt","Median","getMedian","color","colors","get3x3Pixel","sort","_median","Math","floor","PIX_TYPE","WHITE","EYE","OTHER","PIX_COLOR","CLEAR","RED","Horizontal","getHorizontal","current_y","rewrite","first","last","getPix","depth","dir","direction","bottom","right","_i","_depth","result_right","result_left","result_top","result_bottom","hor","Vertical","VarticalScan","_data","_rect","_y","setWhite","_index","ScanAll","scan_y_range","prev_index","prev_y","scan","Center","center","from","ii","top_pix","bottom_pix","clearRect","square","clears","Grayscale","toFixed","getColorDistance","rgb1","rgb2","sqrt","pow","prevLine","nextLine","Lined","config","nextIndex","underIndex","current","next","under","colorDistance","showPoints","outlineColor","getContext","getRect","landmarks","partsIndex","extend_x","extend_y","getPartsPoints","part","point","get2Points","parts","item","x2","y2","LEFT_EYE","RIGHT_EYE","FLAG_KEYS","BW","id","GRAY","COL2","MEDI","CENT","VERT","HORI","LINE","POIN","_EffectFlags","flags","bw","gray","col2","median","vertical","horizonta","line","callbacks","setCallback","func","setEffect","val","callback","getValue","EffectFlags","Effects","left_eye_rect","right_eye_rect","gray_left","gray_right","putImageData","col2_left","col2_right","center_left","center_right","md_left","md_right","vertical_left","vertical_right","clear_left","clear_right","convertToGlobal","line_left","line_right","left_context","right_context","_face","overlay","options","face_eyes_points","init","_src","_overlay","resolved","faceapi","loadTinyFaceDetectorModel","loadFaceLandmarkTinyModel","TinyFaceDetectorOptions","resizeCanvasAndResults","dimensions","canvas","results","HTMLVideoElement","getMediaDimensions","map","res","forSize","drawLandmarks","resizedResults","faceLandmarks","det","drawLandmarksOptions","lineWidth","drawLines","getBoundingClientRect","imageWidth","imageHeight","relativePositions","left_eye_points","right_eye_points","left_face_eye_points","right_face_eye_points","getFaceEyesData","getEyesPoints","detectSingleFace","withFaceLandmarks","effects","face","mounted","props","sx","sy","sw","sh","dx","dy","dw","dh","save","drawImage","restore","ctx_img","faceDetect","pix","watch","immediate","handler","newValue","oldValue","$refs","image","_width","$emit","houghTransform","center_points","max_x","min_x","max_y","min_y","max_r","circle_x","circle_y","radius","q","counts","JSON","stringify","invArr","circles","k","keys","circle","parse","aveCircle","maskDraw","drawLine","_points","_shift","_rate","moveTo","lineTo","stroke","strokeStyle","beginPath","drawLense","grd","createRadialGradient","addColorStop","fillStyle","arc","PI","fill","fillRect","clearLense","deep","wait","minsec","setTimeout","onFlash","components","Vid","Shoot","Overlay","Eyes","eyes","face_eyes_data","Vue","productionTip","render","App","$mount"],"mappings":"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","file":"js/app.1eec256c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('Vid',{on:{\"ready\":_vm.readyVideo}}),_c('Overlay',{ref:\"overlay\",attrs:{\"src\":_vm.src,\"rect\":_vm.rect},on:{\"callbackPoints\":_vm.getPoints}}),_c('Eyes',{attrs:{\"src\":_vm.src,\"rect\":_vm.rect,\"points\":_vm.points}}),_c('Shoot',{on:{\"shoot\":_vm.shoot}}),(_vm.onFlash)?_c('div',{attrs:{\"id\":\"white\"}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"videoFrame\"},[_c('video',{ref:\"video\",staticClass:\"video\",attrs:{\"id\":\"srcVideo\",\"playsinline\":\"\",\"muted\":\"\",\"autoplay\":\"\"},domProps:{\"muted\":true}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export const getUrlParam = () => {\n  let arg = {};\n  const params = location.search.substring(1).split('&');\n  for (let i = 0; params[i]; i++) {\n    let kv = params[i].split('=');\n    arg[kv[0]] = kv[1];\n  }\n  return arg;\n};\n","import * as _ from 'lodash';\nimport { getUrlParam } from './util/getUrlParam';\n\nconst param = getUrlParam();\nexport const isPreview = _.has(param, 'preview');\n\nexport const WINDOW_WIDTH = isPreview ? 375 : window.innerWidth;\nexport const WINDOW_HEIGHT = isPreview ? 812 : window.innerHeight;\n\nexport const VIDEO_WIDTH = 640; //1280 , 1280\nexport const VIDEO_HEIGHT = 480; //720  ,  960\n\nexport const PIXELRATIO = window.devicePixelRatio;\n\n//FaceAPI設定\nexport const FACEAPI_OPTION = {\n  // size at which image is processed, the smaller the faster,\n  // but less precise in detecting smaller faces, must be divisible\n  // by 32, common sizes are 128, 160, 224, 320, 416, 512, 608,\n  // for face tracking via webcam I would recommend using smaller sizes,\n  // e.g. 128, 160, for detecting smaller faces use larger sizes, e.g. 512, 608\n  // default: 416\n  inputSize: 416, //128\n  // minimum confidence threshold\n  // default: 0.5\n  scoreThreshold: 0.5 //0.3\n};\n","import { WINDOW_HEIGHT, WINDOW_WIDTH } from '../config';\n\nexport const adjustVideoSize = video => {\n  const video_size = {\n    w: video.videoWidth,\n    h: video.videoHeight\n  };\n\n  const video_window_rate = WINDOW_HEIGHT / video_size.h;\n\n  const size = {\n    w: video_size.w * video_window_rate,\n    h: WINDOW_HEIGHT\n  };\n\n  const left = (size.w - WINDOW_WIDTH) / 2;\n  const top = (size.h - WINDOW_HEIGHT) / 2;\n\n  const styles = {\n    width: size.w + 'px',\n    height: size.h + 'px',\n    left: -left + 'px',\n    top: -top + 'px'\n  };\n\n  const video_rect = {\n    x: left,\n    y: top,\n    width: size.w,\n    height: size.h,\n    rate: video_window_rate\n  };\n\n  video.width = size.w;\n  video.height = size.h;\n  video.style.width = styles.width;\n  video.style.height = styles.height;\n  video.style.left = styles.left;\n  video.style.top = styles.top;\n\n  console.log(\n    'this.video_window_rate',\n    video_window_rate,\n    'this.video_size.w',\n    video_size.w,\n    'WINDOW_WIDTH',\n    WINDOW_WIDTH,\n    'size.w',\n    size.w,\n    'size.w - WINDOW_WIDTH',\n    size.w - WINDOW_WIDTH,\n    'left',\n    left\n  );\n\n  return {\n    src: video,\n    rect: video_rect\n  };\n};\n","<template>\n  <div class=\"videoFrame\">\n    <!-- 取り込むカメラ映像 -->\n    <video id=\"srcVideo\" class=\"video\" ref=\"video\" playsinline muted autoplay />\n  </div>\n</template>\n<script>\nimport { WINDOW_HEIGHT, WINDOW_WIDTH } from \"../../config\";\nimport { adjustVideoSize } from \"../../util/adjustVideoSize\";\n\nexport default {\n  name: \"vid\",\n  data: () => {\n    return {};\n  },\n  async mounted() {\n    await this.initCamera(this.$refs.video);\n    const info = adjustVideoSize(this.$refs.video);\n    console.log(\"ready\", info);\n    this.$emit(\"ready\", info);\n  },\n  methods: {\n    //カメラを起動\n    initCamera(video) {\n      return new Promise((resolved, rejected) => {\n        let media = navigator.mediaDevices.getUserMedia({\n          audio: false,\n          video: {\n            facingMode: \"user\"\n          }\n        });\n        media\n          .then(stream => {\n            video.muted = true;\n            video.playsinline = true;\n            video.onloadedmetadata = e => {\n              resolved(true);\n            };\n            video.srcObject = stream;\n          })\n          .catch(err => {\n            alert(err);\n            rejected(false);\n          });\n      });\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.video {\n  position: relative;\n  left: 0;\n  top: 0;\n  z-index: 1;\n  // filter: brightness(130%) saturate(80%);\n  transform: scale(-1, 1);\n}\n\n.videoFrame {\n  position: absolute;\n  width: 375px;\n  height: 812px;\n  overflow: hidden;\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Video.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Video.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Video.vue?vue&type=template&id=32dd9186&scoped=true&\"\nimport script from \"./Video.vue?vue&type=script&lang=js&\"\nexport * from \"./Video.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Video.vue?vue&type=style&index=0&id=32dd9186&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"32dd9186\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('canvas',{ref:\"image\",staticClass:\"overlay\",attrs:{\"id\":\"image\",\"width\":_vm.canvas_rect.width+'px',\"height\":_vm.canvas_rect.height+'px'}}),_c('canvas',{ref:\"overlay\",staticClass:\"overlay\",class:_vm.showDetection?'show':'hide',attrs:{\"id\":\"overlay\",\"width\":_vm.canvas_rect.width+'px',\"height\":_vm.canvas_rect.height+'px'}}),_c('div',{staticClass:\"btn\"},[_vm._v(\" visible \"),_c('input',{attrs:{\"type\":\"checkbox\"},on:{\"change\":_vm.toggle}})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as _ from 'lodash';\n\n//rgbの平均値\nconst getColorAverage = (data, index) => {\n  return (data[index] + data[index + 1] + data[index + 2]) / 3;\n};\n\n//dataに色を設定\nconst setPixelColor = (data, index, rgba) => {\n  data[index] = rgba.r;\n  data[index + 1] = rgba.g;\n  data[index + 2] = rgba.b;\n  data[index + 3] = rgba.a;\n};\n\n//2値化\nconst Color2Value = (ctx, rect) => {\n  const THRESHOLD = 40; //閾値\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n  for (let i = 0; i < src.data.length; i += 4) {\n    // let y =\n    //   0.2126 * src.data[i] +\n    //   0.7152 * src.data[i + 1] +\n    //   0.0722 * src.data[i + 2];\n    // let y = 0.299 * src.data[i] + 0.587 * src.data[i + 1] + 0.114 * src.data[i + 2]\n    let y = (src.data[i] + src.data[i + 1] + src.data[i + 2]) / 3;\n    y = parseInt(y, 10);\n    if (y > THRESHOLD) {\n      y = 255;\n    } else {\n      y = 0;\n    }\n    dst.data[i] = y;\n    dst.data[i + 1] = y;\n    dst.data[i + 2] = y;\n    dst.data[i + 3] = src.data[i + 3];\n  }\n  return dst;\n};\n\n//中央値\nconst Median = (ctx, rect) => {\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n\n  const getMedian = (color, i) => {\n    //3x3のピクセル情報\n    const colors = get3x3Pixel(src.data, rect.width, color, i);\n    colors.sort((a, b) => a - b); //降順\n    const _median = colors[Math.floor(colors.length / 2)]; //中央値\n    return _median;\n  };\n\n  // 2行目〜n-1行目\n  for (let n = rect.width * 4; n < src.data.length - rect.width * 4; n += 4) {\n    if (n % (rect.width * 4) === 0) {\n      console.log('empty');\n    } else {\n      dst.data[n] = getMedian(0, n);\n      dst.data[n + 1] = getMedian(1, n);\n      dst.data[n + 2] = getMedian(2, n);\n      dst.data[n + 3] = src.data[n + 3];\n    }\n  }\n\n  return dst;\n};\n\n//フラグ\nconst PIX_TYPE = {\n  WHITE: -1,\n  EYE: -2,\n  OTHER: 1\n};\n\n//色\nconst PIX_COLOR = {\n  WHITE: {\n    r: 255,\n    g: 255,\n    b: 255,\n    a: 255\n  },\n  EYE: {\n    r: 0,\n    g: 0,\n    b: 0,\n    a: 255\n  },\n  CLEAR: {\n    r: 255,\n    g: 255,\n    b: 255,\n    a: 255\n  },\n  RED: {\n    r: 255,\n    g: 0,\n    b: 0,\n    a: 255\n  }\n};\n\n//横方向にn数以内の同じ色で終わる塊がある場合に透過\nconst Horizontal = (ctx, rect) => {\n  const THRESHOLD = 10; //閾値\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n\n  //右方向に色の違いを検索\n  const getHorizontal = (data, index) => {\n    //開始ピクセルが白の場合は検索しない\n    const current_y = getColorAverage(data, index);\n    if (current_y === 255) {\n      return {\n        rewrite: PIX_TYPE.WHITE,\n        first: index,\n        last: index\n      };\n    }\n    const getPix = (i, depth, dir) => {\n      //方向でindexを変える\n      const direction = {\n        top: i - rect.width * 4,\n        bottom: i + rect.width * 4,\n        left: i - 4,\n        right: i + 4\n      };\n      let y = getColorAverage(data, i);\n      //隣が黒の場合か最大数内の場合に隣へ\n      const _i = direction[dir];\n      const _depth = depth + 1;\n      if (depth > THRESHOLD) {\n        return {\n          depth: depth,\n          last: i\n        };\n      } else {\n        if (y === 255) {\n          return {\n            depth: depth,\n            last: i\n          };\n        }\n        return getPix(_i, _depth, dir);\n      }\n    };\n    // const y = getColorAverage(data, index + 1);\n    const result_right = getPix(index, 0, 'right');\n    const result_left = getPix(index, 0, 'left');\n    const result_top = getPix(index, 0, 'top');\n    const result_bottom = getPix(index, 0, 'bottom');\n\n    // console.log(result_top.depth, result_bottom.depth);\n\n    if (\n      result_right.depth < THRESHOLD &&\n      result_left.depth < THRESHOLD &&\n      result_top.depth < THRESHOLD &&\n      result_bottom.depth < THRESHOLD\n    ) {\n      return {\n        rewrite: PIX_TYPE.OTHER,\n        first: index,\n        // last: result.last\n        last: result_right\n      };\n    } else {\n      //黒目かも\n      return {\n        rewrite: PIX_TYPE.EYE,\n        first: index,\n        // last: result.last\n        last: result_right\n      };\n    }\n  };\n\n  // console.log('horizontal', rect.width, rect.height, src.data.length);\n  for (let i = 0; i < src.data.length; i += 4) {\n    const hor = getHorizontal(src.data, i);\n    if (hor.rewrite === PIX_TYPE.WHITE) {\n      //もともと白(検索する必要がない)\n      setPixelColor(dst.data, i, PIX_COLOR.WHITE);\n    } else if (hor.rewrite === PIX_TYPE.EYE) {\n      //左隣が黒(黒目の可能性が高い)\n      setPixelColor(dst.data, i, PIX_COLOR.EYE);\n    } else {\n      //削除\n      setPixelColor(dst.data, i, PIX_COLOR.CLEAR);\n    }\n  }\n  return dst;\n};\n\n//黒ピクセル開始から縦に閾値内で白に変わるものは非表示\nconst Vertical = (ctx, rect) => {\n  const THRESHOLD = 5; //閾値=高さ\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n  for (let i = 0; i < src.data.length; i++) {\n    dst.data[i] = src.data[i];\n  }\n\n  //最初に検出した黒ピクセル\n  const VarticalScan = (_data, _rect, index) => {\n    const getPix = (i, depth) => {\n      const _i = i + _rect.width * 4;\n      const _y = getColorAverage(_data, _i);\n      const _depth = depth + 1;\n\n      if (depth > THRESHOLD) {\n        return {\n          result: false,\n          depth\n        };\n      } else if (_y === 255) {\n        return {\n          result: true,\n          depth\n        };\n      } else {\n        return getPix(_i, _depth);\n      }\n    };\n    //上から黒ピクセル検出までの数\n    return getPix(index, 0);\n  };\n\n  //index~depthの範囲を白くする\n  const setWhite = (data, _rect, index, depth) => {\n    for (let i = 0; i <= depth; i++) {\n      const _index = i * (_rect.width * 4) + index;\n      data[_index] = 255;\n      data[_index + 1] = 0;\n      data[_index + 2] = 255;\n      data[_index + 3] = 255;\n    }\n  };\n\n  //左上から検索\n  const ScanAll = (_data, _rect) => {\n    const scan_y_range = 4; // 4/1の範囲\n    for (let y = 0; y < Math.floor(_rect.height / scan_y_range); y++) {\n      for (let x = 0; x < _rect.width; x++) {\n        const index = Math.floor(y * (_rect.width * 4) + x * 4);\n        const prev_index = Math.floor((y - 1) * (_rect.width * 4) + x * 4);\n        const _y = getColorAverage(_data, index);\n        const prev_y = getColorAverage(_data, prev_index);\n        if (prev_y === 255 && _y === 0) {\n          const scan = VarticalScan(_data, _rect, index);\n          //塊だけ白くする\n          if (scan.result && scan.depth > 1) {\n            // console.log('setwhite', scan.result, scan.depth);\n            setWhite(dst.data, _rect, index, scan.depth);\n          }\n        }\n      }\n    }\n  };\n  ScanAll(src.data, rect);\n  return dst;\n};\n\n//範囲の中心点を抽出し、その中心の上下方向の境界を抽出し、それを半径とした円の外を削除する\nconst Center = (ctx, rect) => {\n  const THRESHOLD = 1.2; //幅の拡張\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n\n  const center = {\n    x: Math.floor(rect.width / 2),\n    y: Math.floor(rect.height / 2)\n  };\n\n  //境界を検出,最初に検出した黒ピクセル\n  const ScanAll = data => {\n    const getPix = (i, depth, from) => {\n      //方向でindexを変える\n      const direction = ii => {\n        return {\n          top: () => {\n            return ii + rect.width * 4;\n          },\n          bottom: () => {\n            return ii - rect.width * 4;\n          }\n        };\n      };\n      const _y = getColorAverage(data, i);\n      const _i = direction(i)[from]();\n      const _depth = depth + 1;\n\n      if (_y === 0 || depth > Math.floor(rect.height / 2)) {\n        return depth;\n      } else {\n        return getPix(_i, _depth, from);\n      }\n    };\n\n    //上から黒ピクセル検出までの数\n    const top_pix = center.x * 4;\n    const top = getPix(top_pix, 0, 'top');\n\n    //下から黒ピクセル検出までの数\n    const bottom_pix = rect.height * (rect.width * 4) + center.x * 4;\n    const bottom = getPix(bottom_pix, 0, 'bottom');\n\n    return {\n      top,\n      bottom\n    };\n  };\n\n  //rectを非表示\n  const clearRect = (data, rect, square) => {\n    for (let y = 0; y < rect.height; y++) {\n      for (let x = 0; x < rect.width; x++) {\n        const index = Math.floor(y * (rect.width * 4) + x * 4);\n        if (\n          x >= square.x &&\n          x <= square.x + square.width &&\n          y >= square.y &&\n          y <= square.y + square.height\n        ) {\n          data[index] = src.data[index];\n          data[index + 1] = src.data[index + 1];\n          data[index + 2] = src.data[index + 2];\n          data[index + 3] = src.data[index + 3];\n        } else {\n          data[index] = 255;\n          data[index + 1] = 255;\n          data[index + 2] = 255;\n          data[index + 3] = 255;\n        }\n      }\n    }\n  };\n\n  const { top, bottom } = ScanAll(src.data);\n  const length = rect.height - top - bottom;\n  // console.log('>', top, bottom, length);\n  const clears = [\n    {\n      x: Math.floor(rect.width / 2) - Math.floor(rect.height / 2),\n      y: top,\n      width: rect.height * THRESHOLD,\n      height: rect.height - bottom\n    }\n  ];\n  clearRect(dst.data, rect, clears[0]);\n  return dst;\n};\n\n//グレー\nconst Grayscale = (ctx, rect, n) => {\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n  let colors = [];\n  for (let i = 0; i < src.data.length; i += 4) {\n    let y =\n      (0.2126 * src.data[i] +\n        0.7152 * src.data[i + 1] +\n        0.0722 * src.data[i + 2]) /\n      3;\n    // let y = parseInt((src.data[i] + src.data[i + 1] + src.data[i + 2]) / 3);\n    y = parseInt(y, n);\n    let rate = y * (n / 255);\n    y = 255 * rate.toFixed(1);\n    dst.data[i] = y;\n    dst.data[i + 1] = y;\n    dst.data[i + 2] = y;\n    dst.data[i + 3] = src.data[i + 3];\n    colors.push(y);\n  }\n\n  //colorsの最大と最小\n  console.log('colors = ', _.max(colors), _.min(colors));\n\n  return dst;\n};\n\n//枠内の全体の明るさを平均化\nconst Brightness = (ctx, rect) => {\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let bright = 0;\n  for (let i = 0; i < src.data.length; i += 4) {\n    let y = (src.data[i] + src.data[i + 1] + src.data[i + 2]) / 3;\n    bright += y;\n  }\n  const brightness = bright / src.data.length / 4;\n  return brightness;\n};\n\nconst Bezer = (ctx, rect) => {\n  // let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  // let dst = ctx.createImageData(rect.width, rect.height);\n  const p = [{ x: 0, y: 0 }, { x: 50, y: 50 }, { x: 100, y: 0 }];\n  const _x = n => {\n    return (\n      (p[2].x - 2 * p[1].x + p[0].x) * (n * n) +\n      2 * (p[1].x - p[0].x) * n +\n      p[0].x\n    );\n  };\n  const _y = n => {\n    return (\n      (p[2].y - 2 * p[1].x + p[0].y) * (n * n) +\n      2 * (p[1].y - p[0].y) * n +\n      p[0].y\n    );\n  };\n\n  let array = [];\n  for (let i = 0; i < 100; i++) {\n    array[i] = {\n      x: _x(i),\n      y: _y(i)\n    };\n  }\n  // console.log(array);\n};\n\n/**\n * 三次元空間の距離\n */\nconst getColorDistance = (rgb1, rgb2) => {\n  return Math.sqrt(\n    Math.pow(rgb1.r - rgb2.r, 2) +\n      Math.pow(rgb1.g - rgb2.g, 2) +\n      Math.pow(rgb1.b - rgb2.b, 2)\n  );\n};\n\n/*\n * 同じ色の3x3のピクセルを取得\n */\nconst get3x3Pixel = (_data, width, color, index) => {\n  const prevLine = index - width * 4;\n  const nextLine = index + width * 4;\n  return [\n    _data[prevLine - 4 + color],\n    _data[prevLine + color],\n    _data[prevLine + 4 + color],\n    _data[index - 4 + color],\n    _data[index + color],\n    _data[index + 4 + color],\n    _data[nextLine - 4 + color],\n    _data[nextLine + color],\n    _data[nextLine + 4 + color]\n  ];\n};\n\n/**\n *Canvasを空にする\n * @param {DOM} elm\n */\nconst clearCanvas = elm => {\n  const canvas = document.querySelector(elm);\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, rect.width, rect.height);\n};\n\nconst Lined = (ctx, rect) => {\n  let src = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let dst = ctx.createImageData(rect.width, rect.height);\n\n  let points = [];\n\n  //設定\n  let config = {};\n  config.outlineColor = { r: 0, g: 255, b: 128 }; //色\n  config.colorDistance = 1; //エッジ検出量\n  config.hideline = 30; //排除する上下の行数\n  config.showPoints = true; //頂点を描画\n\n  for (let y = 0; y < rect.height; y++) {\n    for (let x = 0; x < rect.width; x++) {\n      const index = Math.floor(y * (rect.width * 4) + x * 4);\n      const nextIndex = Math.floor(y * (rect.width * 4) + (x + 1) * 4);\n      const underIndex = Math.floor((y + 1) * (rect.width * 4) + x * 4);\n      // チェックするピクセルの色\n      const current = {\n        r: src.data[index],\n        g: src.data[index + 1],\n        b: src.data[index + 2]\n      };\n      // 右隣の色\n      const next = {\n        r: src.data[nextIndex],\n        g: src.data[nextIndex + 1],\n        b: src.data[nextIndex + 2]\n      };\n      // 下の色\n      const under = {\n        r: src.data[underIndex],\n        g: src.data[underIndex + 1],\n        b: src.data[underIndex + 2]\n      };\n      // console.log('draw', current);\n\n      dst.data[index] = src.data[index];\n      dst.data[index + 1] = src.data[index + 1];\n      dst.data[index + 2] = src.data[index + 2];\n      dst.data[index + 3] = src.data[index + 3];\n\n      //上下左右は対象外\n      if (x >= rect.width - 2 || y >= rect.height - 2 || x <= 1 || y <= 1) {\n        dst.data[index] = 255;\n        dst.data[index + 1] = 255;\n        dst.data[index + 2] = 255;\n        dst.data[index + 3] = 255;\n      } else {\n        // 現在のピクセルと右隣、下の色の三次元空間上の距離を閾値と比較する\n        if (\n          getColorDistance(current, next) > config.colorDistance ||\n          getColorDistance(current, under) > config.colorDistance\n        ) {\n          if (config.showPoints) {\n            dst.data[index] = config.outlineColor.r;\n            dst.data[index + 1] = config.outlineColor.g;\n            dst.data[index + 2] = config.outlineColor.b;\n            points.push({ x: x + 1, y: y + 1 });\n          }\n        }\n      }\n    }\n  }\n\n  const getContext = () => {\n    return dst;\n  };\n\n  const getPoints = () => {\n    return points;\n  };\n\n  return {\n    getContext,\n    getPoints\n  };\n};\n\nexport {\n  getColorAverage,\n  setPixelColor,\n  Color2Value,\n  Median,\n  Horizontal,\n  Vertical,\n  Center,\n  Grayscale,\n  Brightness,\n  Bezer,\n  getColorDistance,\n  get3x3Pixel,\n  clearCanvas,\n  Lined\n};\n","import * as _ from 'lodash';\nimport { getColorDistance } from './imageUtil';\nimport { exIndexOf } from './util';\n\n/**\n * ２点座標で範囲を取得\n */\nconst getRect = (landmarks, partsIndex) => {\n  //拡張量 > 検出領域を広げる\n  const extend_x = 0.05;\n  const extend_y = 0.07;\n\n  //partsIndexのポイントを全て取得\n  const getPartsPoints = part => {\n    return _.map(partsIndex, index => {\n      return { index, point: landmarks[index] };\n    });\n  };\n\n  //２点座標で範囲を取得\n  const get2Points = part => {\n    const parts = _.map(partsIndex, index => {\n      return { index, point: landmarks[index] };\n    });\n    const rect = {\n      //左上\n      x:\n        _.minBy(parts, item => {\n          return item.point.x;\n        }).point.x + -extend_x,\n      y:\n        _.minBy(parts, item => {\n          return item.point.y;\n        }).point.y *\n        (1 - extend_y),\n      //右下\n      x2:\n        _.maxBy(parts, item => {\n          return item.point.x;\n        }).point.x + extend_x,\n      y2:\n        _.maxBy(parts, item => {\n          return item.point.y;\n        }).point.y *\n        (1 + extend_y)\n    };\n\n    return rect;\n  };\n\n  return {\n    get2Points,\n    getPartsPoints\n  };\n};\n\n/*\n *排除する行のpixelインデックス配列\n */\nconst getHideLineIndex = (data, n, width) => {\n  const lines = data.length / width;\n  let indexs = [];\n\n  //上部\n  for (let i = 0; i < n * width; i++) {\n    indexs.push(i);\n  }\n  //下部\n  const start = lines * width - n * width;\n  for (let i = start; i < lines * width; i++) {\n    indexs.push(i);\n  }\n  //左部\n  for (let i = 0; i <= lines; i++) {\n    for (let j = 1; j <= n; j++) {\n      indexs.push(j + i * width * 4);\n    }\n  }\n  //右部\n  for (let i = 0; i < lines; i++) {\n    for (let j = width * 4 - n; j <= width * 4; j++) {\n      indexs.push(j + i * width * 4);\n    }\n  }\n\n  return indexs;\n};\n\nconst getPixels = (rect, elem) => {\n  //設定\n  let config = {};\n  config.outlineColor = { r: 0, g: 255, b: 0 }; //色\n  config.colorDistance = 25; //エッジ検出量閾値\n  config.hideline = 30; //排除する上下の行数\n  config.showPoints = true; //頂点を描画するかどうか\n\n  const ctx = elem.getContext('2d');\n  let imageData = ctx.getImageData(rect.x, rect.y, rect.width, rect.height);\n  let data = imageData.data;\n\n  //上下左右のノイズをカットする\n  const hideIndexs = getHideLineIndex(data, config.hideline, rect.width);\n\n  //有効頂点\n  let points = [];\n\n  for (var i = 0, l = data.length; i < l; i += 4) {\n    if ((i / 4 + 1) % elem.width === 0) {\n      data[i + 3] = 0;\n    } else {\n      var currentIndex = i,\n        nextIndex = currentIndex + 4,\n        underIndex = currentIndex + rect.width * 4,\n        // チェックするピクセルの色\n        current = {\n          r: data[currentIndex],\n          g: data[currentIndex + 1],\n          b: data[currentIndex + 2]\n        },\n        // 右隣の色\n        next = {\n          r: data[nextIndex],\n          g: data[nextIndex + 1],\n          b: data[nextIndex + 2]\n        },\n        // 下の色\n        under = {\n          r: data[underIndex],\n          g: data[underIndex + 1],\n          b: data[underIndex + 2]\n        };\n\n      // 現在のピクセルと右隣、下の色の三次元空間上の距離を閾値と比較する\n      // console.log(\"draw\", current, next,under);\n      if (\n        getColorDistance(current, next) > config.colorDistance ||\n        getColorDistance(current, under) > config.colorDistance\n      ) {\n        //カットした範囲\n        if (exIndexOf(hideIndexs, i) == -1) {\n          const y = Math.floor(currentIndex / rect.width) + 1;\n          const x = currentIndex - (y - 1) * rect.width;\n          // points.push({x,y});\n          points.push({\n            x: x + rect.x,\n            y: y + rect.y\n          });\n\n          //TODO:pointに変換する\n          if (config.showPoints) {\n            data[i] = config.outlineColor.r;\n            data[i + 1] = config.outlineColor.g;\n            data[i + 2] = config.outlineColor.b;\n          } else {\n            data[i + 3] = 0;\n          }\n        } else {\n          data[i + 3] = 0;\n        }\n      } else {\n        data[i + 3] = 0;\n      }\n    }\n  }\n\n  // 書き換えたdataをimageDataにもどし、描画する\n  imageData.data = data;\n  return imageData;\n\n  // const shadowctx = document.querySelector('#overlay').getContext(\"2d\");\n  // shadowctx.putImageData(imageData,rect.x,rect.y);\n\n  // return points;\n};\n\nconst drawPoint = (canvas, point, rate, shift, color) => {\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n  ctx.fillStyle = color;\n  ctx.fillRect(\n    rect.width * point.x * rate.x + shift.x - 2,\n    rect.height * point.y * rate.y + shift.y - 2,\n    4,\n    4\n  );\n};\n\nconst drawPoints = (canvas, points, color) => {\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n  ctx.fillStyle = color;\n  _.map(points, point => {\n    ctx.fillRect(point.x, point.y, 1, 1);\n  });\n};\n\nexport { getRect, getHideLineIndex, getPixels, drawPoint, drawPoints };\n","//パーツごとのインデックス\nexport const LEFT_EYE = [42, 43, 44, 45, 46, 47];\nexport const RIGHT_EYE = [36, 37, 38, 39, 40, 41];\nexport const LEFT_BROWS = [26, 25, 24, 23, 22];\nexport const RIGHT_BROWS = [21, 20, 19, 18, 17];\nexport const NOSE = [34, 35, 33, 32, 31, 30, 29, 28, 27];\nexport const MOUSE = [\n  48,\n  49,\n  50,\n  51,\n  52,\n  53,\n  54,\n  55,\n  56,\n  57,\n  58,\n  59,\n  60,\n  61,\n  62,\n  63,\n  64,\n  65,\n  66,\n  67,\n  68\n];\nexport const FACE = [16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0];\n","import * as _ from 'lodash';\n\nexport const FLAG_KEYS = {\n  BW: { key: 'bw', id: 'ctrBW' },\n  GRAY: { key: 'gray', id: 'ctrGray' },\n  COL2: { key: 'col2', id: 'ctrCol2' },\n  MEDI: { key: 'median', id: 'ctrMedian' },\n  CENT: { key: 'center', id: 'ctrCenter' },\n  VERT: { key: 'vertical', id: 'ctrVert' },\n  HORI: { key: 'horizontal', id: 'ctrHori' },\n  LINE: { key: 'line', id: 'ctrLine' },\n  POIN: { key: 'point', id: 'ctrPoint' }\n};\n\nconst _EffectFlags = () => {\n  let flags = {\n    bw: true,\n    gray: false,\n    col2: false,\n    median: true,\n    center: true,\n    vertical: true,\n    horizonta: false,\n    line: false,\n    point: false\n  };\n\n  let callbacks = [];\n\n  const setCallback = func => {\n    callbacks.push(func);\n  };\n\n  const setEffect = (key, val) => {\n    flags[key] = val;\n    _.map(callbacks, callback => {\n      callback(flags);\n    });\n  };\n\n  const getValue = key => {\n    return flags[key];\n  };\n\n  return {\n    setCallback,\n    setEffect,\n    getValue\n  };\n};\n\nexport const EffectFlags = _EffectFlags();\n","import * as _ from 'lodash';\nimport {\n  Grayscale,\n  Color2Value,\n  Center,\n  Median,\n  Horizontal,\n  Lined,\n  Vertical\n} from '../../util/imageUtil';\nimport { EffectFlags, FLAG_KEYS } from '../effects/EffectFlags';\n/**\n * エフェクトの適用\n */\nexport const Effects = (ctx, left_eye_rect, right_eye_rect) => {\n  //明るさ\n  // const left_bright = Brightness(ctx, left_eye_rect);\n  // const right_bright = Brightness(ctx, right_eye_rect);\n  // console.log(left_bright.toFixed(1), right_bright.toFixed(1));\n\n  //グレー\n  if (EffectFlags.getValue(FLAG_KEYS.GRAY.key)) {\n    console.log('effect:gray');\n    const gray_left = Grayscale(ctx, left_eye_rect, 10);\n    const gray_right = Grayscale(ctx, right_eye_rect, 10);\n    ctx.putImageData(gray_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(gray_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //ここから２値化\n  if (EffectFlags.getValue(FLAG_KEYS.BW.key)) {\n    console.log('effect:bw');\n    const col2_left = Color2Value(ctx, left_eye_rect);\n    const col2_right = Color2Value(ctx, right_eye_rect);\n    ctx.putImageData(col2_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(col2_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //中央だけ残す\n  if (EffectFlags.getValue(FLAG_KEYS.CENT.key)) {\n    console.log('effect:center');\n    const center_left = Center(ctx, left_eye_rect);\n    const center_right = Center(ctx, right_eye_rect);\n    ctx.putImageData(center_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(center_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //ここから中央値\n  if (EffectFlags.getValue(FLAG_KEYS.MEDI.key)) {\n    console.log('effect:median');\n    let md_left = Median(ctx, left_eye_rect);\n    let md_right = Median(ctx, right_eye_rect);\n    ctx.putImageData(md_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(md_right, right_eye_rect.x, right_eye_rect.y);\n\n    md_left = Median(ctx, left_eye_rect);\n    md_right = Median(ctx, right_eye_rect);\n    ctx.putImageData(md_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(md_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //まぶた周辺を消す\n  if (EffectFlags.getValue(FLAG_KEYS.VERT.key)) {\n    console.log('effect:vertical');\n    const vertical_left = Vertical(ctx, left_eye_rect);\n    const vertical_right = Vertical(ctx, right_eye_rect);\n    ctx.putImageData(vertical_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(vertical_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //塊排除\n  if (EffectFlags.getValue(FLAG_KEYS.HORI.key)) {\n    console.log('effect:horizontal');\n    const clear_left = Horizontal(ctx, left_eye_rect);\n    const clear_right = Horizontal(ctx, right_eye_rect);\n    ctx.putImageData(clear_left, left_eye_rect.x, left_eye_rect.y);\n    ctx.putImageData(clear_right, right_eye_rect.x, right_eye_rect.y);\n  }\n\n  //頂点情報\n  const getPoints = () => {\n    const convertToGlobal = (points, rect) => {\n      return _.map(points, point => {\n        return {\n          x: point.x + rect.x,\n          y: point.y + rect.y\n        };\n      });\n    };\n\n    //線\n    const line_left = Lined(ctx, left_eye_rect);\n    const line_right = Lined(ctx, right_eye_rect);\n    const left = line_left.getPoints();\n    const right = line_right.getPoints();\n\n    if (EffectFlags.getValue(FLAG_KEYS.LINE.key)) {\n      const left_context = line_left.getContext();\n      const right_context = line_right.getContext();\n      ctx.putImageData(left_context, left_eye_rect.x, left_eye_rect.y);\n      ctx.putImageData(right_context, right_eye_rect.x, right_eye_rect.y);\n    }\n\n    return {\n      left: convertToGlobal(left, left_eye_rect),\n      right: convertToGlobal(right, right_eye_rect)\n    };\n  };\n\n  return {\n    getPoints\n  };\n};\n","/* eslint-disable */\nimport { getRect } from '../util/canvasUtil';\nimport { LEFT_EYE, RIGHT_EYE } from '../constants/face';\nimport { Effects } from '../components/effects/Effects';\nimport { FACEAPI_OPTION } from '../config';\n\nconst _face = () => {\n  let src = null; //video\n  let overlay = null; //canvas\n  let options = null;\n  let face_eyes_points = {};\n  let shift = {};\n  let rate = {};\n\n  const init = (_src, _overlay) => {\n    overlay = _overlay;\n    src = _src;\n    console.log('load models');\n    //FaceAPiのモジュールを取得\n    return new Promise(async resolved => {\n      await faceapi.loadTinyFaceDetectorModel(\n        '/js/tiny_face_detector_model-weights_manifest.json'\n      );\n      await faceapi.loadFaceLandmarkTinyModel(\n        '/js/face_landmark_68_tiny_model-weights_manifest.json'\n      );\n      options = new faceapi.TinyFaceDetectorOptions(FACEAPI_OPTION);\n      console.log('loaded models');\n      resolved();\n    });\n  };\n\n  //videoからcanvasサイズを変換\n  const resizeCanvasAndResults = (dimensions, canvas, results) => {\n    const { width, height } =\n      dimensions instanceof HTMLVideoElement\n        ? faceapi.getMediaDimensions(dimensions)\n        : dimensions;\n    // canvas.width = width;\n    // canvas.height = height;\n    return results.map(res => res.forSize(width, height));\n  };\n\n  const drawLandmarks = (video, canvas, results) => {\n    const resizedResults = resizeCanvasAndResults(video, canvas, results);\n    const faceLandmarks = resizedResults.map(det => det.landmarks);\n    //faceapiで線を描画しているので、faceLandmarksから目の座標を取り出して、自前でキャンバスに描画をする\n    const drawLandmarksOptions = {\n      lineWidth: 2,\n      drawLines: true,\n      color: 'green'\n    };\n    faceapi.drawLandmarks(canvas, faceLandmarks, drawLandmarksOptions);\n\n    //ここから自前で描画\n    const rect = canvas.getBoundingClientRect();\n\n    //縮尺計算\n    rate = {\n      x: faceLandmarks[0].imageWidth / rect.width,\n      y: faceLandmarks[0].imageHeight / rect.height\n    };\n\n    shift = faceLandmarks[0].shift;\n\n    console.log('face', faceLandmarks[0].relativePositions, shift);\n\n    //目のポイントから範囲の２点を取得\n    const left_eye_points = getRect(\n      faceLandmarks[0].relativePositions,\n      LEFT_EYE\n    ).get2Points();\n    const right_eye_points = getRect(\n      faceLandmarks[0].relativePositions,\n      RIGHT_EYE\n    ).get2Points();\n\n    //目の全頂点\n    const left_face_eye_points = getRect(\n      faceLandmarks[0].relativePositions,\n      LEFT_EYE\n    ).getPartsPoints();\n\n    const right_face_eye_points = getRect(\n      faceLandmarks[0].relativePositions,\n      RIGHT_EYE\n    ).getPartsPoints();\n\n    const left_eye_rect = {\n      x: Math.floor(rect.width * left_eye_points.x * rate.x + shift.x),\n      y: Math.floor(rect.height * left_eye_points.y * rate.y + shift.y),\n      width: Math.floor(\n        rect.width * left_eye_points.x2 * rate.x -\n          rect.width * left_eye_points.x * rate.x\n      ),\n      height: Math.floor(\n        rect.height * left_eye_points.y2 * rate.y -\n          rect.height * left_eye_points.y * rate.y\n      )\n    };\n\n    const right_eye_rect = {\n      x: Math.floor(rect.width * right_eye_points.x * rate.x + shift.x),\n      y: Math.floor(rect.height * right_eye_points.y * rate.y + shift.y),\n      width: Math.floor(\n        rect.width * right_eye_points.x2 * rate.x -\n          rect.width * right_eye_points.x * rate.x\n      ),\n      height: Math.floor(\n        rect.height * right_eye_points.y2 * rate.y -\n          rect.height * right_eye_points.y * rate.y\n      )\n    };\n\n    return {\n      left_eye_rect,\n      right_eye_rect,\n      left_eye_points,\n      right_eye_points,\n      left_face_eye_points,\n      right_face_eye_points,\n      rate,\n      shift\n    };\n  };\n\n  /**\n   * FaceAPiの両目の頂点\n   */\n  const getFaceEyesData = () => {\n    return { points: face_eyes_points, shift, rate };\n  };\n\n  const getEyesPoints = () => {\n    return new Promise(async resolved => {\n      //faceapiの検出結果を取得\n\n      let result = await faceapi\n        .detectSingleFace(overlay, options)\n        .withFaceLandmarks(true);\n      if (result) {\n        // //検出したデータから描画\n        const {\n          left_eye_rect,\n          right_eye_rect,\n          left_eye_points,\n          right_eye_points,\n          left_face_eye_points,\n          right_face_eye_points,\n          rate,\n          shift\n        } = drawLandmarks(src, overlay, [result]);\n\n        console.log('eyes', left_face_eye_points, right_face_eye_points);\n\n        face_eyes_points = {\n          left: left_face_eye_points,\n          right: right_face_eye_points\n        };\n\n        //ここから画像処理\n        const effects = Effects(\n          overlay.getContext('2d'),\n          left_eye_rect,\n          right_eye_rect\n        );\n        //両目の頂点情報\n        const points = effects.getPoints();\n        resolved(points);\n      }\n    });\n  };\n\n  return {\n    init,\n    getFaceEyesData,\n    getEyesPoints\n  };\n};\n\nexport const face = _face();\n","<template>\n  <div>\n    <canvas\n      ref=\"image\"\n      class=\"overlay\"\n      id=\"image\"\n      :width=\"canvas_rect.width+'px'\"\n      :height=\"canvas_rect.height+'px'\"\n    />\n    <canvas\n      ref=\"overlay\"\n      class=\"overlay\"\n      id=\"overlay\"\n      :width=\"canvas_rect.width+'px'\"\n      :height=\"canvas_rect.height+'px'\"\n      :class=\"showDetection?'show':'hide'\"\n    />\n    <div class=\"btn\">\n      visible\n      <input type=\"checkbox\" @change=\"toggle\" />\n    </div>\n  </div>\n</template>\n<script>\nimport * as _ from \"lodash\";\nimport { WINDOW_WIDTH, WINDOW_HEIGHT } from \"../../config\";\nimport { face } from \"../../util/face\";\n\nexport default {\n  data: () => {\n    return {\n      showDetection: false,\n      canvas_rect: {}\n    };\n  },\n  mounted() {\n    console.log(\"overlay mounted\");\n  },\n  props: {\n    rect: Object,\n    src: HTMLVideoElement\n  },\n  methods: {\n    toggle(e) {\n      this.showDetection = !this.showDetection;\n    },\n    //撮影\n    shoot() {\n      console.log(\"shoot\");\n      const size = {\n        w: this.canvas_rect.width,\n        h: this.canvas_rect.height\n      };\n\n      const rects = {\n        sx: this.rect.x / this.rect.rate,\n        sy: 0,\n        sw: size.w / this.rect.rate,\n        sh: size.h / this.rect.rate,\n        dx: 0,\n        dy: 0,\n        dw: WINDOW_WIDTH,\n        dh: WINDOW_HEIGHT\n      };\n\n      //ここから画像処理用オーバーレイ\n      //video(this.src)画像をoverlayに描画\n      const ctx = this.$refs.overlay.getContext(\"2d\");\n      ctx.clearRect(0, 0, this.canvas_rect.width, this.canvas_rect.height);\n      ctx.save();\n      ctx.drawImage(\n        this.src,\n        rects.sx,\n        rects.sy,\n        rects.sw,\n        rects.sh,\n        0,\n        0,\n        rects.dw,\n        rects.dh\n      );\n      ctx.restore();\n\n      //ここから顔画像\n      //video(this.src)画像をoverlayに描画\n      const ctx_img = this.$refs.image.getContext(\"2d\");\n      ctx_img.clearRect(0, 0, this.canvas_rect.width, this.canvas_rect.height);\n      ctx_img.save();\n      ctx_img.drawImage(\n        this.src,\n        rects.sx,\n        rects.sy,\n        rects.sw,\n        rects.sh,\n        0,\n        0,\n        rects.dw,\n        rects.dh\n      );\n      ctx_img.restore();\n      this.faceDetect();\n    },\n    pix(n) {\n      return n + \"px\";\n    },\n    async faceDetect() {\n      //ここで頂点を取得\n      const points = await face.getEyesPoints();\n      //ここでfaceAPiの両目のポイントを取得\n      const eyes_points_data = face.getFaceEyesData();\n      //リサイズ\n      const _width = this.rect.width - this.rect.x * 2;\n      this.canvas_rect = {\n        width: _width,\n        height: this.rect.height\n      };\n      console.log(\"faceDetect\");\n      this.$emit(\"callbackPoints\", points, eyes_points_data);\n    }\n  },\n  watch: {\n    src: {\n      immediate: true,\n      handler(newValue, oldValue) {\n        if (newValue !== oldValue) {\n          this.src = newValue;\n          //faceAPiに取得用imageと描画用canvasを渡す\n          face.init(this.$refs.image, this.$refs.overlay);\n        }\n      }\n    },\n    rect: {\n      immediate: true,\n      handler(newValue, oldValue) {\n        if (newValue !== oldValue && this.$refs.overlay) {\n          const _width = newValue.width - newValue.x * 2;\n          this.canvas_rect = {\n            width: _width,\n            height: newValue.height\n          };\n        }\n      }\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n@import \"./canvas.scss\";\n.btn {\n  position: absolute;\n  z-index: 3;\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Overlay.vue?vue&type=template&id=629ebacb&scoped=true&\"\nimport script from \"./Overlay.vue?vue&type=script&lang=js&\"\nexport * from \"./Overlay.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Overlay.vue?vue&type=style&index=0&id=629ebacb&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"629ebacb\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"btn\",on:{\"click\":_vm.shoot}},[_vm._v(\"shoot\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <button class=\"btn\" @click=\"shoot\">shoot</button>\n</template>\n<script>\nexport default {\n  data: () => {\n    return {};\n  },\n  methods: {\n    shoot() {\n      this.$emit(\"shoot\");\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.btn {\n  width: 180px;\n  height: 60px;\n  position: fixed;\n  bottom: 16px;\n  left: calc(50vw - 90px);\n  z-index: 10;\n  border: none;\n  background: white;\n  outline: none;\n  &:active {\n    transform: scale(1.05);\n  }\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Shoot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Shoot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Shoot.vue?vue&type=template&id=782f7a9d&scoped=true&\"\nimport script from \"./Shoot.vue?vue&type=script&lang=js&\"\nexport * from \"./Shoot.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Shoot.vue?vue&type=style&index=0&id=782f7a9d&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"782f7a9d\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('canvas',{ref:\"canvas\",staticClass:\"overlay\",attrs:{\"width\":_vm.canvas_rect.width+'px',\"height\":_vm.canvas_rect.height+'px'}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as _ from 'lodash';\n\n//ハフ変換\nexport const houghTransform = points => {\n  //円の中心点の候補\n  let center_points = [];\n\n  //黒目の上端、下端、左端、右端\n  const max_x = _.maxBy(points, function(point) {\n    return point.x;\n  }).x;\n  const min_x = _.minBy(points, function(point) {\n    return point.x;\n  }).x;\n  const max_y = _.maxBy(points, function(point) {\n    return point.y;\n  }).y;\n  const min_y = _.minBy(points, function(point) {\n    return point.y;\n  }).y;\n  //最大半径\n  const max_r = (max_x - min_x) / 2;\n\n  //黒目の輪郭線上の点を通る円の中心点\n  for (let i = 0; i < points.length; i++) {\n    //候補点(x,y)を順番に取り出して確認する\n    let circle_x = points[i].x;\n    let circle_y = points[i].y;\n\n    //円の中心点(p,q)\n    const radius = (x, y, p, q) => {\n      return Math.sqrt((x - p) * (x - p) + (y - q) * (y - q));\n    };\n\n    for (let q = min_y; q < max_y; q++) {\n      for (let p = min_x; p < max_x; p++) {\n        let r = radius(circle_x, circle_y, p, q);\n        if (r >= max_r * 0.8 && r < max_r * 1.2) {\n          center_points.push({ p: p, q: q, r: r });\n        }\n      }\n    }\n  }\n\n  let counts = {};\n  for (let j = 0; j < center_points.length; j++) {\n    let key = JSON.stringify(center_points[j]);\n    counts[key] = counts[key] ? counts[key] + 1 : 1;\n  }\n\n  let invArr = _.invert(counts);\n\n  let circles = [];\n  for (\n    let k = Object.keys(invArr).length;\n    k > Object.keys(invArr).length - 3;\n    k--\n  ) {\n    const circle = JSON.parse(invArr[k]);\n    circles.push(circle);\n  }\n\n  const aveCircle = {\n    p: _.sumBy(circles, 'p') / circles.length,\n    q: _.sumBy(circles, 'q') / circles.length,\n    r: _.sumBy(circles, 'r') / circles.length\n  };\n\n  return aveCircle;\n};\n","//canvasでマスク\n//https://qiita.com/keiskimu/items/140e6b8c7b81bf01d390\n//pathをpathでマスクするには本当はclipかもしれない\n//http://www.htmq.com/canvas/clip.shtml\n\nexport const maskDraw = (canvas, points, shift, rate) => {\n  const drawLine = (_points, _rect, index, _shift, _rate) => {\n    const nextIndex = _points.length == index + 1 ? 0 : index + 1; //_points.lengthと一緒ならなら原点へ\n    ctx.moveTo(\n      Math.floor(_points[index].point.x * _rect.width * _rate.x + shift.x),\n      Math.floor(_points[index].point.y * _rect.height * _rate.y + shift.y)\n    );\n    ctx.lineTo(\n      Math.floor(_points[nextIndex].point.x * _rect.width * _rate.x + shift.x),\n      Math.floor(_points[nextIndex].point.y * _rect.height * _rate.y + shift.y)\n    );\n\n    if (_points.length == index + 1) {\n      // ctx.clip();\n      ctx.stroke();\n    } else {\n      drawLine(_points, _rect, nextIndex, _shift, _rate);\n    }\n  };\n\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n  ctx.strokeStyle = 'red';\n  ctx.beginPath();\n  drawLine(points, rect, 0, shift, rate);\n};\n\nexport const drawLense = (canvas, circle) => {\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n\n  //円を描画\n  let grd = ctx.createRadialGradient(\n    circle.p,\n    circle.q,\n    5,\n    circle.p,\n    circle.q,\n    circle.r * 1.02\n  );\n  grd.addColorStop(0, 'rgba(13,13,13,0.5)');\n  grd.addColorStop(0.5, 'rgba(242,172,87,0.75)');\n  grd.addColorStop(1, 'rgba(115, 110, 110, 0.65)');\n  ctx.fillStyle = grd;\n\n  ctx.beginPath();\n  ctx.arc(circle.p, circle.q, circle.r, 0, 2 * Math.PI);\n  ctx.fill();\n\n  //中心点を描画\n  ctx.fillStyle = '#ff0000';\n  ctx.fillRect(circle.p, circle.q, 1, 1);\n};\n\nexport const clearLense = canvas => {\n  const rect = canvas.getBoundingClientRect();\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, rect.width, rect.height);\n};\n","<template>\n  <div>\n    <canvas\n      ref=\"canvas\"\n      class=\"overlay\"\n      :width=\"canvas_rect.width+'px'\"\n      :height=\"canvas_rect.height+'px'\"\n    />\n  </div>\n</template>\n<script>\nimport * as _ from \"lodash\";\nimport { houghTransform } from \"../../util/houghTransform\";\nimport { drawLense, clearLense, maskDraw } from \"../../util/drawLense\";\nexport default {\n  data: () => {\n    return {\n      canvas_rect: {}\n    };\n  },\n  props: {\n    rect: Object,\n    src: HTMLVideoElement,\n    points: Object\n  },\n  watch: {\n    rect: {\n      immediate: true,\n      deep: true,\n      handler(newValue, oldValue) {\n        if (\n          JSON.stringify(newValue) !== JSON.stringify(oldValue) &&\n          this.$refs.canvas\n        ) {\n          const _width = newValue.width - newValue.x * 2;\n          this.canvas_rect = {\n            width: _width,\n            height: newValue.height\n          };\n        }\n      }\n    },\n    points: {\n      immediate: true,\n      deep: true,\n      handler(newValue, oldValue) {\n        if (\n          JSON.stringify(newValue) !== JSON.stringify(oldValue) &&\n          Object.keys(newValue).length > 0\n        ) {\n          console.log(\"Eyes shift rate\", newValue.shift.x, newValue.rate.x);\n          const left = houghTransform(newValue.eyes.left);\n          const right = houghTransform(newValue.eyes.right);\n          const shift = newValue.shift;\n          const rate = newValue.rate;\n          clearLense(this.$refs.canvas);\n          //canvasclip()\n          drawLense(this.$refs.canvas, left);\n          drawLense(this.$refs.canvas, right);\n          //マスク\n          maskDraw(this.$refs.canvas, newValue.face.left, shift, rate);\n          maskDraw(this.$refs.canvas, newValue.face.right, shift, rate);\n        }\n      }\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n@import \"./canvas.scss\";\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Eyes.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Eyes.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Eyes.vue?vue&type=template&id=442eebb6&scoped=true&\"\nimport script from \"./Eyes.vue?vue&type=script&lang=js&\"\nexport * from \"./Eyes.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Eyes.vue?vue&type=style&index=0&id=442eebb6&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"442eebb6\",\n  null\n  \n)\n\nexport default component.exports","export const wait = minsec => {\n  return new Promise(resolved => {\n    setTimeout(() => {\n      resolved();\n    }, minsec);\n  });\n};\n","<template>\n  <div id=\"app\">\n    <!-- 動画 -->\n    <Vid @ready=\"readyVideo\" />\n    <!-- 撮影した写真を表示 -->\n    <Overlay ref=\"overlay\" :src=\"src\" :rect=\"rect\" @callbackPoints=\"getPoints\" />\n    <!-- コンタクトレンズ -->\n    <Eyes :src=\"src\" :rect=\"rect\" :points=\"points\" />\n    <!-- 撮影ボタン -->\n    <Shoot @shoot=\"shoot\" />\n    <!-- フラッシュ -->\n    <div v-if=\"onFlash\" id=\"white\"></div>\n  </div>\n</template>\n\n<script>\nimport Vid from \"./components/video/Video\";\nimport Overlay from \"./components/video/Overlay\";\nimport Shoot from \"./components/shoot/Shoot\";\nimport Eyes from \"./components/video/Eyes\";\nimport { wait } from \"./util/wait\";\n\nexport default {\n  name: \"app\",\n  data: () => {\n    return {\n      src: null,\n      rect: {},\n      points: {},\n      onFlash: false\n    };\n  },\n  components: {\n    Vid,\n    Shoot,\n    Overlay,\n    Eyes\n  },\n  mounted() {},\n  methods: {\n    readyVideo(value) {\n      this.rect = value.rect;\n      this.src = value.src;\n    },\n    //カメラ撮影\n    async shoot() {\n      this.onFlash = true;\n      await wait(100);\n      this.$refs.overlay.shoot();\n      await wait(300);\n      this.onFlash = false;\n    },\n    //ここで両目の頂点情報を取得\n    getPoints(points, face_eyes_data) {\n      this.points = {\n        eyes: points,\n        face: face_eyes_data.points,\n        shift: face_eyes_data.shift,\n        rate: face_eyes_data.rate\n      };\n      console.log(\"points\", points, face_eyes_data);\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\nbody {\n  margin: 0;\n}\n#white {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100vw;\n  height: 100vh;\n  background-color: white;\n  z-index: 99;\n}\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=40c3cb32&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport App from './App.vue'\n\nVue.config.productionTip = false\n\nnew Vue({\n  render: h => h(App),\n}).$mount('#app')\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Eyes.vue?vue&type=style&index=0&id=442eebb6&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Eyes.vue?vue&type=style&index=0&id=442eebb6&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Shoot.vue?vue&type=style&index=0&id=782f7a9d&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Shoot.vue?vue&type=style&index=0&id=782f7a9d&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=style&index=0&id=629ebacb&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=style&index=0&id=629ebacb&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Video.vue?vue&type=style&index=0&id=32dd9186&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Video.vue?vue&type=style&index=0&id=32dd9186&lang=scss&scoped=true&\""],"sourceRoot":""}